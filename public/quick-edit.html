<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Label Editor Access</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 24px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            color: white;
            font-size: 14px;
        }

        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        .url-builder {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background: #333;
            border-radius: 4px;
            word-break: break-all;
        }

        .recent-list {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
        }

        .recent-item {
            padding: 12px;
            background: #333;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .recent-item:hover {
            background: #444;
        }

        .filename {
            flex: 1;
            font-family: monospace;
            font-size: 13px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .instructions {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .instructions code {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quick Label Editor Access</h1>

        <div class="instructions">
            <h2 style="margin-bottom: 10px;">How to Use</h2>
            <p><strong>Option 1:</strong> Fill in the image and label paths below to generate a direct link</p>
            <p><strong>Option 2:</strong> Copy a URL from your recent FiftyOne sessions (saved below)</p>
            <p><strong>Option 3:</strong> Manually paste an image path you found in FiftyOne</p>
        </div>

        <div class="url-builder">
            <h2 style="margin-bottom: 15px;">URL Builder</h2>

            <div class="input-group">
                <label>Image Path</label>
                <input type="text" id="imagePath" placeholder="/data/datasets/your-dataset/images/image001.jpg">
            </div>

            <div class="input-group">
                <label>Label Path (auto-filled)</label>
                <input type="text" id="labelPath" placeholder="/data/datasets/your-dataset/labels/image001.txt" readonly>
            </div>

            <button onclick="openEditor()">Open in Label Editor</button>
            <button onclick="copyUrl()" style="background: #6c757d;">Copy URL</button>

            <div id="result" class="result" style="display: none;">
                <strong>Generated URL:</strong><br>
                <span id="generatedUrl"></span>
            </div>
        </div>

        <div class="recent-list">
            <h2 style="margin-bottom: 15px;">Recent Files</h2>
            <div id="recentList">
                <p style="color: #aaa;">No recent files yet. Open an image to see it here.</p>
            </div>
        </div>
    </div>

    <script>
        // Auto-update label path when image path changes
        document.getElementById('imagePath').addEventListener('input', function(e) {
            const imagePath = e.target.value;
            if (imagePath) {
                const labelPath = imagePath
                    .replace('/images/', '/labels/')
                    .replace(/\.(jpg|jpeg|png|JPG|JPEG|PNG)$/, '.txt');
                document.getElementById('labelPath').value = labelPath;
            }
        });

        function generateUrl() {
            const imagePath = document.getElementById('imagePath').value;
            const labelPath = document.getElementById('labelPath').value;

            if (!imagePath) {
                alert('Please enter an image path');
                return null;
            }

            const url = `${window.location.origin}/label-editor.html?image=${encodeURIComponent(imagePath)}&label=${encodeURIComponent(labelPath)}`;
            return url;
        }

        function openEditor() {
            const url = generateUrl();
            if (url) {
                // Save to recent
                saveRecent(document.getElementById('imagePath').value);

                // Open in new tab
                window.open(url, '_blank');

                // Show URL
                document.getElementById('generatedUrl').textContent = url;
                document.getElementById('result').style.display = 'block';
            }
        }

        function copyUrl() {
            const url = generateUrl();
            if (url) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('URL copied to clipboard!');
                    document.getElementById('generatedUrl').textContent = url;
                    document.getElementById('result').style.display = 'block';
                });
            }
        }

        function saveRecent(imagePath) {
            if (!imagePath) return;

            let recent = JSON.parse(localStorage.getItem('recentFiles') || '[]');

            // Remove if already exists
            recent = recent.filter(path => path !== imagePath);

            // Add to front
            recent.unshift(imagePath);

            // Keep only last 10
            recent = recent.slice(0, 10);

            localStorage.setItem('recentFiles', JSON.stringify(recent));
            loadRecent();
        }

        function loadRecent() {
            const recent = JSON.parse(localStorage.getItem('recentFiles') || '[]');
            const container = document.getElementById('recentList');

            if (recent.length === 0) {
                container.innerHTML = '<p style="color: #aaa;">No recent files yet. Open an image to see it here.</p>';
                return;
            }

            container.innerHTML = recent.map(imagePath => {
                const filename = imagePath.split('/').pop();
                const labelPath = imagePath
                    .replace('/images/', '/labels/')
                    .replace(/\.(jpg|jpeg|png|JPG|JPEG|PNG)$/, '.txt');
                const url = `${window.location.origin}/label-editor.html?image=${encodeURIComponent(imagePath)}&label=${encodeURIComponent(labelPath)}`;

                return `
                    <div class="recent-item">
                        <div class="filename">${imagePath}</div>
                        <button class="btn-small" onclick="window.open('${url}', '_blank')">Open Editor</button>
                    </div>
                `;
            }).join('');
        }

        // Load recent files on page load
        loadRecent();

        // Check for URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const imageParam = urlParams.get('image');
        if (imageParam) {
            document.getElementById('imagePath').value = imageParam;
            document.getElementById('imagePath').dispatchEvent(new Event('input'));
        }
    </script>
</body>
</html>
