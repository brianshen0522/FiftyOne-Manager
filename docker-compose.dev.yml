services:
  mongodb-dev:
    image: mongo:7
    container_name: fiftyone-mongodb-dev
    ports:
      - "27018:27017"
    volumes:
      - mongodb-data-dev:/data/db
    environment:
      - MONGO_INITDB_DATABASE=fiftyone
    restart: unless-stopped
    command: mongod --quiet

  fiftyone-manager-dev:
    build: .
    container_name: fiftyone-manager_v3-dev
    depends_on:
      - mongodb-dev
    ports:
      - "${MANAGER_PORT:-3000}:${MANAGER_PORT:-3000}"
      - "${PORT_START}-${PORT_END}:${PORT_START}-${PORT_END}"
    volumes:
      - ${DATASET_BASE_PATH}:${DATASET_BASE_PATH}:rw
      - ./instances.json:/app/instances.json
      - pm2-logs-dev:/root/.pm2/logs
    environment:
      - DATASET_BASE_PATH=${DATASET_BASE_PATH}
      - PORT_START=${PORT_START}
      - PORT_END=${PORT_END}
      - MANAGER_PORT=${MANAGER_PORT:-3000}
      - PUBLIC_ADDRESS=${PUBLIC_ADDRESS:-localhost}
      - DEFAULT_IOU_THRESHOLD=${DEFAULT_IOU_THRESHOLD:-0.8}
      - DEFAULT_DEBUG_MODE=${DEFAULT_DEBUG_MODE:-false}
      - FIFTYONE_DATABASE_URI=mongodb://mongodb-dev:27017
    restart: unless-stopped

volumes:
  pm2-logs-dev:
  mongodb-data-dev:
