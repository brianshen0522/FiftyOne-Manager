import Script from 'next/script';

const styles = "* {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: #1a1a1a;\n            color: #ffffff;\n            padding: 20px;\n        }\n\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n        }\n\n        h1 {\n            margin-bottom: 20px;\n            font-size: 24px;\n        }\n\n        .input-group {\n            margin-bottom: 20px;\n        }\n\n        label {\n            display: block;\n            margin-bottom: 8px;\n            color: #aaa;\n            font-size: 14px;\n        }\n\n        input, select {\n            width: 100%;\n            padding: 10px;\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            color: white;\n            font-size: 14px;\n        }\n\n        button {\n            padding: 10px 20px;\n            background: #007bff;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            margin-right: 10px;\n        }\n\n        button:hover {\n            background: #0056b3;\n        }\n\n        .url-builder {\n            background: #2a2a2a;\n            padding: 20px;\n            border-radius: 8px;\n            margin-bottom: 30px;\n        }\n\n        .result {\n            margin-top: 20px;\n            padding: 15px;\n            background: #333;\n            border-radius: 4px;\n            word-break: break-all;\n        }\n\n        .recent-list {\n            background: #2a2a2a;\n            padding: 20px;\n            border-radius: 8px;\n        }\n\n        .recent-item {\n            padding: 12px;\n            background: #333;\n            margin-bottom: 10px;\n            border-radius: 4px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .recent-item:hover {\n            background: #444;\n        }\n\n        .filename {\n            flex: 1;\n            font-family: monospace;\n            font-size: 13px;\n        }\n\n        .btn-small {\n            padding: 6px 12px;\n            font-size: 12px;\n        }\n\n        .instructions {\n            background: #2a2a2a;\n            padding: 20px;\n            border-radius: 8px;\n            margin-bottom: 30px;\n            line-height: 1.6;\n        }\n\n        .instructions code {\n            background: #333;\n            padding: 2px 6px;\n            border-radius: 3px;\n            font-family: monospace;\n        }";
const bodyHtml = "<div class=\"container\">\n        <h1>Quick Label Editor Access</h1>\n\n        <div class=\"instructions\">\n            <h2 style=\"margin-bottom: 10px;\">How to Use</h2>\n            <p><strong>Option 1:</strong> Fill in the image and label paths below to generate a direct link</p>\n            <p><strong>Option 2:</strong> Copy a URL from your recent FiftyOne sessions (saved below)</p>\n            <p><strong>Option 3:</strong> Manually paste an image path you found in FiftyOne</p>\n        </div>\n\n        <div class=\"url-builder\">\n            <h2 style=\"margin-bottom: 15px;\">URL Builder</h2>\n\n            <div class=\"input-group\">\n                <label>Image Path</label>\n                <input type=\"text\" id=\"imagePath\" placeholder=\"/data/datasets/your-dataset/images/image001.jpg\">\n            </div>\n\n            <div class=\"input-group\">\n                <label>Label Path (auto-filled)</label>\n                <input type=\"text\" id=\"labelPath\" placeholder=\"/data/datasets/your-dataset/labels/image001.txt\" readonly>\n            </div>\n\n            <button onclick=\"openEditor()\">Open in Label Editor</button>\n            <button onclick=\"copyUrl()\" style=\"background: #6c757d;\">Copy URL</button>\n\n            <div id=\"result\" class=\"result\" style=\"display: none;\">\n                <strong>Generated URL:</strong><br>\n                <span id=\"generatedUrl\"></span>\n            </div>\n        </div>\n\n        <div class=\"recent-list\">\n            <h2 style=\"margin-bottom: 15px;\">Recent Files</h2>\n            <div id=\"recentList\">\n                <p style=\"color: #aaa;\">No recent files yet. Open an image to see it here.</p>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Auto-update label path when image path changes\n        document.getElementById('imagePath').addEventListener('input', function(e) {\n            const imagePath = e.target.value;\n            if (imagePath) {\n                const labelPath = imagePath\n                    .replace('/images/', '/labels/')\n                    .replace(/\\.(jpg|jpeg|png|JPG|JPEG|PNG)$/, '.txt');\n                document.getElementById('labelPath').value = labelPath;\n            }\n        });\n\n        function generateUrl() {\n            const imagePath = document.getElementById('imagePath').value;\n            const labelPath = document.getElementById('labelPath').value;\n\n            if (!imagePath) {\n                alert('Please enter an image path');\n                return null;\n            }\n\n            const url = `${window.location.origin}/label-editor.html?image=${encodeURIComponent(imagePath)}&label=${encodeURIComponent(labelPath)}`;\n            return url;\n        }\n\n        function openEditor() {\n            const url = generateUrl();\n            if (url) {\n                // Save to recent\n                saveRecent(document.getElementById('imagePath').value);\n\n                // Open in new tab\n                window.open(url, '_blank');\n\n                // Show URL\n                document.getElementById('generatedUrl').textContent = url;\n                document.getElementById('result').style.display = 'block';\n            }\n        }\n\n        function copyUrl() {\n            const url = generateUrl();\n            if (url) {\n                navigator.clipboard.writeText(url).then(() => {\n                    alert('URL copied to clipboard!');\n                    document.getElementById('generatedUrl').textContent = url;\n                    document.getElementById('result').style.display = 'block';\n                });\n            }\n        }\n\n        function saveRecent(imagePath) {\n            if (!imagePath) return;\n\n            let recent = JSON.parse(localStorage.getItem('recentFiles') || '[]');\n\n            // Remove if already exists\n            recent = recent.filter(path => path !== imagePath);\n\n            // Add to front\n            recent.unshift(imagePath);\n\n            // Keep only last 10\n            recent = recent.slice(0, 10);\n\n            localStorage.setItem('recentFiles', JSON.stringify(recent));\n            loadRecent();\n        }\n\n        function loadRecent() {\n            const recent = JSON.parse(localStorage.getItem('recentFiles') || '[]');\n            const container = document.getElementById('recentList');\n\n            if (recent.length === 0) {\n                container.innerHTML = '<p style=\"color: #aaa;\">No recent files yet. Open an image to see it here.</p>';\n                return;\n            }\n\n            container.innerHTML = recent.map(imagePath => {\n                const filename = imagePath.split('/').pop();\n                const labelPath = imagePath\n                    .replace('/images/', '/labels/')\n                    .replace(/\\.(jpg|jpeg|png|JPG|JPEG|PNG)$/, '.txt');\n                const url = `${window.location.origin}/label-editor.html?image=${encodeURIComponent(imagePath)}&label=${encodeURIComponent(labelPath)}`;\n\n                return `\n                    <div class=\"recent-item\">\n                        <div class=\"filename\">${imagePath}</div>\n                        <button class=\"btn-small\" onclick=\"window.open('${url}', '_blank')\">Open Editor</button>\n                    </div>\n                `;\n            }).join('');\n        }\n\n        // Load recent files on page load\n        loadRecent();\n\n        // Check for URL parameters\n        const urlParams = new URLSearchParams(window.location.search);\n        const imageParam = urlParams.get('image');\n        if (imageParam) {\n            document.getElementById('imagePath').value = imageParam;\n            document.getElementById('imagePath').dispatchEvent(new Event('input'));\n        }\n    </script>";

export const metadata = {
  title: "Quick Label Editor Access"
};

export default function Page() {
  return (
    <>
      <style dangerouslySetInnerHTML={{ __html: styles }} />
      <div dangerouslySetInnerHTML={{ __html: bodyHtml }} />
      <Script src="/js/quick-edit.js" strategy="afterInteractive" />
    </>
  );
}
