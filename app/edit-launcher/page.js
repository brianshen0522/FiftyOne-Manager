import Script from 'next/script';

const styles = "* {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: #1a1a1a;\n            color: #ffffff;\n            padding: 40px 20px;\n        }\n        .container {\n            max-width: 800px;\n            margin: 0 auto;\n        }\n        h1 {\n            font-size: 28px;\n            margin-bottom: 10px;\n        }\n        .subtitle {\n            color: #aaa;\n            margin-bottom: 30px;\n        }\n        .card {\n            background: #2a2a2a;\n            border-radius: 8px;\n            padding: 30px;\n            margin-bottom: 20px;\n        }\n        .card h2 {\n            font-size: 18px;\n            margin-bottom: 15px;\n        }\n        textarea {\n            width: 100%;\n            padding: 12px;\n            background: #1a1a1a;\n            border: 1px solid #3a3a3a;\n            border-radius: 4px;\n            color: white;\n            font-family: monospace;\n            font-size: 13px;\n            min-height: 80px;\n            resize: vertical;\n        }\n        button {\n            padding: 12px 24px;\n            background: #007bff;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: 500;\n            margin-top: 15px;\n        }\n        button:hover {\n            background: #0056b3;\n        }\n        .btn-secondary {\n            background: #6c757d;\n        }\n        .btn-secondary:hover {\n            background: #545b62;\n        }\n        .success {\n            color: #28a745;\n            margin-top: 15px;\n        }\n        .steps {\n            list-style: none;\n            counter-reset: step-counter;\n        }\n        .steps li {\n            counter-increment: step-counter;\n            margin-bottom: 20px;\n            padding-left: 40px;\n            position: relative;\n        }\n        .steps li::before {\n            content: counter(step-counter);\n            position: absolute;\n            left: 0;\n            top: 0;\n            background: #007bff;\n            color: white;\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n            font-size: 14px;\n        }\n        .steps code {\n            background: #1a1a1a;\n            padding: 2px 6px;\n            border-radius: 3px;\n            font-family: monospace;\n        }\n        .info-box {\n            background: #1a3a5a;\n            border-left: 4px solid #007bff;\n            padding: 15px;\n            margin: 20px 0;\n            border-radius: 4px;\n        }";
const bodyHtml = "<div class=\"container\">\n        <h1>Label Editor Launcher</h1>\n        <p class=\"subtitle\">Quickly open the label editor from FiftyOne</p>\n\n        <div class=\"card\">\n            <h2>Quick Launch</h2>\n            <p style=\"margin-bottom: 15px; color: #aaa;\">Paste the URL from FiftyOne operator here:</p>\n            <textarea id=\"urlInput\" placeholder=\"//&#123;hostname&#125;:3000/open-editor.html?image=/path/to/image.jpg&label=/path/to/label.txt&port=3000\"></textarea>\n            <button onclick=\"openFromUrl()\">Open Editor</button>\n            <button class=\"btn-secondary\" onclick=\"document.getElementById('urlInput').value = ''\">Clear</button>\n            <div id=\"success\" class=\"success\" style=\"display: none;\"></div>\n        </div>\n\n        <div class=\"card\">\n            <h2>How It Works</h2>\n            <ol class=\"steps\">\n                <li>\n                    In FiftyOne, select an image and run the <code>Edit Label in Tool</code> operator (press backtick <code>`</code>)\n                </li>\n                <li>\n                    Copy the URL from the \"Open Editor\" field in the operator result\n                </li>\n                <li>\n                    Paste it into the text box above and click <strong>Open Editor</strong>\n                </li>\n                <li>\n                    The label editor will open automatically using your current IP address!\n                </li>\n            </ol>\n        </div>\n\n        <div class=\"info-box\">\n            <strong>\ud83d\udca1 Pro Tip:</strong> Bookmark this page for quick access! You can find it at:\n            <code id=\"currentUrl\"></code>\n        </div>\n    </div>\n\n    <script>\n        // Show current URL\n        document.getElementById('currentUrl').textContent = window.location.href;\n\n        function openFromUrl() {\n            const input = document.getElementById('urlInput').value.trim();\n\n            if (!input) {\n                alert('Please paste a URL first');\n                return;\n            }\n\n            try {\n                // Extract parameters from the URL\n                let urlToParse = input;\n\n                // If it starts with //, add protocol\n                if (urlToParse.startsWith('//')) {\n                    urlToParse = window.location.protocol + urlToParse;\n                }\n\n                // Replace {hostname} placeholder with current hostname\n                urlToParse = urlToParse.replace('{hostname}', window.location.hostname);\n                urlToParse = urlToParse.replace('%7Bhostname%7D', window.location.hostname);\n\n                // Parse URL\n                const url = new URL(urlToParse);\n                const params = new URLSearchParams(url.search);\n\n                const imagePath = params.get('image');\n                const labelPath = params.get('label');\n\n                if (!imagePath || !labelPath) {\n                    alert('Invalid URL: missing image or label path');\n                    return;\n                }\n\n                // Get config from server to get the correct port\n                fetch('/api/config')\n                    .then(response => response.json())\n                    .then(config => {\n                        const protocol = window.location.protocol;\n                        const publicAddress = config.publicAddress || window.location.hostname;\n                        const managerPort = params.get('port') || config.managerPort || '5000';\n                        const editorUrl = `${protocol}//${publicAddress}:${managerPort}/label-editor.html?image=${encodeURIComponent(imagePath)}&label=${encodeURIComponent(labelPath)}`;\n\n                        // Open in new tab\n                        window.open(editorUrl, '_blank');\n\n                        // Show success message\n                        const successDiv = document.getElementById('success');\n                        successDiv.textContent = `\u2713 Opened label editor for ${imagePath.split('/').pop()}`;\n                        successDiv.style.display = 'block';\n\n                        // Clear input after a moment\n                        setTimeout(() => {\n                            document.getElementById('urlInput').value = '';\n                            successDiv.style.display = 'none';\n                        }, 3000);\n                    })\n                    .catch(error => {\n                        alert('Error fetching config: ' + error.message);\n                    });\n\n            } catch (error) {\n                alert('Error parsing URL: ' + error.message);\n            }\n        }\n\n        // Allow Enter key in textarea to open editor\n        document.getElementById('urlInput').addEventListener('keydown', function(e) {\n            if (e.ctrlKey && e.key === 'Enter') {\n                openFromUrl();\n            }\n        });\n    </script>";

export const metadata = {
  title: "Label Editor Launcher"
};

export default function Page() {
  return (
    <>
      <style dangerouslySetInnerHTML={{ __html: styles }} />
      <div dangerouslySetInnerHTML={{ __html: bodyHtml }} />
      <Script src="/js/edit-launcher.js" strategy="afterInteractive" />
    </>
  );
}
