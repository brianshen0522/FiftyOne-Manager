import Script from 'next/script';

const styles = "body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            background: #1a1a1a;\n            color: #ffffff;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            height: 100vh;\n            margin: 0;\n        }\n        .container {\n            text-align: center;\n            padding: 40px;\n        }\n        .spinner {\n            border: 4px solid #333;\n            border-top: 4px solid #28a745;\n            border-radius: 50%;\n            width: 60px;\n            height: 60px;\n            animation: spin 1s linear infinite;\n            margin: 0 auto 30px;\n        }\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n        h1 {\n            font-size: 24px;\n            margin-bottom: 10px;\n            color: #28a745;\n        }\n        p {\n            color: #aaa;\n            margin-bottom: 20px;\n        }\n        .manual-link {\n            display: none;\n            margin-top: 30px;\n        }\n        .manual-link a {\n            color: #007bff;\n            text-decoration: none;\n            padding: 12px 24px;\n            border: 2px solid #007bff;\n            border-radius: 4px;\n            display: inline-block;\n            font-weight: 500;\n        }\n        .manual-link a:hover {\n            background: #007bff;\n            color: white;\n        }\n        .countdown {\n            font-size: 48px;\n            color: #28a745;\n            margin: 20px 0;\n        }";
const bodyHtml = "<div class=\"container\">\n        <div class=\"spinner\"></div>\n        <h1>Opening Label Editor...</h1>\n        <div class=\"countdown\" id=\"countdown\">3</div>\n        <p id=\"status\">Redirecting in <span id=\"seconds\">3</span> seconds...</p>\n        <div class=\"manual-link\" id=\"manualLink\">\n            <p>If the editor doesn't open automatically:</p>\n            <a id=\"editorLink\" href=\"#\" target=\"_blank\">Click Here to Open Label Editor</a>\n        </div>\n    </div>\n\n    <script>\n        (function() {\n            // Get the target URL from query parameter\n            const urlParams = new URLSearchParams(window.location.search);\n            const targetUrl = urlParams.get('url');\n\n            if (!targetUrl) {\n                document.getElementById('status').textContent = 'Error: No URL specified';\n                document.querySelector('.spinner').style.display = 'none';\n                return;\n            }\n\n            // Set the manual link\n            const manualLink = document.getElementById('editorLink');\n            manualLink.href = targetUrl;\n\n            // Countdown from 3 to 1\n            let count = 3;\n            const countdownEl = document.getElementById('countdown');\n            const secondsEl = document.getElementById('seconds');\n\n            const countdownInterval = setInterval(() => {\n                count--;\n                countdownEl.textContent = count;\n                secondsEl.textContent = count;\n\n                if (count === 0) {\n                    clearInterval(countdownInterval);\n                    openEditor();\n                }\n            }, 1000);\n\n            function openEditor() {\n                try {\n                    // Try to open in a new tab\n                    const newWindow = window.open(targetUrl, '_blank');\n\n                    // Check if popup was blocked\n                    setTimeout(() => {\n                        if (!newWindow || newWindow.closed || typeof newWindow.closed === 'undefined') {\n                            // Popup was blocked\n                            document.getElementById('status').textContent = 'Popup blocked! Please click the link below:';\n                            document.querySelector('.spinner').style.display = 'none';\n                            document.querySelector('.countdown').style.display = 'none';\n                            document.getElementById('manualLink').style.display = 'block';\n                        } else {\n                            // Success!\n                            document.getElementById('status').textContent = '\u2713 Label editor opened! You can close this tab.';\n                            document.querySelector('.spinner').style.display = 'none';\n                            document.querySelector('.countdown').style.display = 'none';\n\n                            // Close this tab after 2 seconds\n                            setTimeout(() => {\n                                window.close();\n                            }, 2000);\n                        }\n                    }, 500);\n\n                } catch (error) {\n                    // Error opening window\n                    document.getElementById('status').textContent = 'Error: ' + error.message;\n                    document.querySelector('.spinner').style.display = 'none';\n                    document.querySelector('.countdown').style.display = 'none';\n                    document.getElementById('manualLink').style.display = 'block';\n                }\n            }\n\n        })();\n    </script>";

export const metadata = {
  title: "Opening Label Editor..."
};

export default function Page() {
  return (
    <>
      <style dangerouslySetInnerHTML={{ __html: styles }} />
      <div dangerouslySetInnerHTML={{ __html: bodyHtml }} />
      <Script src="/js/auto-open.js" strategy="afterInteractive" />
    </>
  );
}
